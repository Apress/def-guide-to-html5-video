<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Guide to HTML5 video: chapter 8: example 8</title>
  </head>
  <body>
    <h1>Chapter 8: example 8</h1>
    <canvas width="512" height="200"></canvas>
    <script type="text/javascript">
      var audio = new Audio();
      audio.mozSetup(1, 44100);
      var samples = new Float32Array(22050);
      for(var i=0, l=samples.length; i< l; i++) {
        samples[i] = Math.sin(i / 40);
      }

      var canvas = document.getElementsByTagName("canvas")[0];
      var context = canvas.getContext('2d');      
      function playSound() {
        audio.mozWriteAudio(samples);
        context.fillRect(0, 0, 512, 200);
        context.strokeStyle = "#FFFFFF";
        context.lineWidth = 2;
        var width = 512;
        var step = parseInt(22050 / width);
        img = context.getImageData(0, 0, 512, 200);
        context.fillRect(0, 0, 512, 200);
        context.beginPath();
        context.moveTo(0, 100-samples[0]*100);
        for(var i=1; i< width; i++) {
          context.lineTo(i, 100-samples[i*step]*100);
        }
        context.stroke();
      }
    </script>
    <button onclick="playSound();">Play</button>
  </body>
</html>